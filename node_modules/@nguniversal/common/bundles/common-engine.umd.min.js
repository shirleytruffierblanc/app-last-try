!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("fs"),require("@angular/compiler"),require("@angular/core"),require("@angular/platform-server")):"function"==typeof define&&define.amd?define("@nguniversal/common/engine",["exports","fs","@angular/compiler","@angular/core","@angular/platform-server"],r):r((e.nguniversal=e.nguniversal||{},e.nguniversal.common=e.nguniversal.common||{},e.nguniversal.common.engine={}),e.fs,e.ng.compiler,e.ng.core,e.ng.platformServer)}(this,function(e,r,t,n,o){"use strict";
/**
 * @license
 * Copyright Google LLC All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */var i=function(){function e(){}return e.prototype.get=function(e){return new Promise(function(t,n){r.readFile(e,function(e,r){if(e)return n(e);t(r.toString())})})},e}(),a=function(e,r){var t="function"==typeof Symbol&&e[Symbol.iterator];if(!t)return e;var n,o,i=t.call(e),a=[];try{for(;(void 0===r||r-- >0)&&!(n=i.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return a},u=function(){function e(e,r){void 0===r&&(r=[]),this.moduleOrFactory=e,this.providers=r,this.factoryCacheMap=new Map,this.templateCache={}}return e.prototype.getCompiler=function(){return o.platformDynamicServer().injector.get(n.CompilerFactory).createCompiler([{providers:[{provide:t.ResourceLoader,useClass:i,deps:[]}]}])},e.prototype.render=function(e){return r=this,void 0,n=function(){var r,t,n;return function(e,r){var t,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function c(i){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,n&&(o=n[2&i[0]?"return":i[0]?"throw":"next"])&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[0,o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=r.call(e,a)}catch(e){i=[6,e],n=0}finally{t=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}}(this,function(i){switch(i.label){case 0:return(r=e.document)?[3,2]:[4,this.getDocument(e.documentFilePath)];case 1:r=i.sent(),i.label=2;case 2:return t=function(){for(var e=[],r=0;r<arguments.length;r++)e=e.concat(a(arguments[r]));return e}(e.providers||[],this.providers||[],[{provide:o.INITIAL_CONFIG,useValue:{document:r,url:e.url}}]),[4,this.getFactory()];case 3:return n=i.sent(),[2,o.renderModuleFactory(n,{extraProviders:t})]}})},new((t=void 0)||(t=Promise))(function(e,o){function i(e){try{u(n.next(e))}catch(e){o(e)}}function a(e){try{u(n.throw(e))}catch(e){o(e)}}function u(r){r.done?e(r.value):new t(function(e){e(r.value)}).then(i,a)}u((n=n.apply(r,[])).next())});var r,t,n},e.prototype.getFactory=function(){var e=this,r=this.moduleOrFactory;if(r instanceof n.NgModuleFactory)return Promise.resolve(r);var t=this.factoryCacheMap.get(r);return t?Promise.resolve(t):this.getCompiler().compileModuleAsync(r).then(function(t){return e.factoryCacheMap.set(r,t),t})},e.prototype.getDocument=function(e){var t=this.templateCache[e]=this.templateCache[e]||r.readFileSync(e).toString();return Promise.resolve(t)},e}();
/**
 * @license
 * Copyright Google LLC All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
/**
 * @license
 * Copyright Google LLC All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
/**
 * @license
 * Copyright Google LLC All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
e.ɵFileLoader=i,e.ɵCommonEngine=u,Object.defineProperty(e,"__esModule",{value:!0})});